(()=>{"use strict";var t={cardTemplateSelector:"#card-template",elementSelector:".element",imageSelector:".element__image",binSelector:".element__bin",nameSelector:".element__text",likeSelector:".element__like",likeActiveClass:"element__like_active",likeCountSelector:".element__like-count"},e="form.popup__container",n=".popup__button",r={formSelector:e,inputSelector:".popup__input",errorSelector:".popup__error",errorActiveSelector:".popup__error_active",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"};function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=function t(e,n,r,i,u){var c=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"_init",(function(t){var e=t.cardTemplateSelector,n=t.elementSelector,r=t.imageSelector,o=t.binSelector,i=t.nameSelector,u=t.likeSelector,a=t.likeActiveClass,l=t.likeCountSelector;c._likeActiveClass=a,c._card=document.querySelector(e).content.querySelector(n).cloneNode(!0),c._image=c._card.querySelector(r),c._binButton=c._card.querySelector(o),c._nameElement=c._card.querySelector(i),c._likeElement=c._card.querySelector(u),c._likeCountElement=c._card.querySelector(l)})),o(this,"setCard",(function(t){var e=t._id,n=t.link,r=t.name,o=t.likes;c._id=e,c._link=n,c._name=r,c._likes=o,c._likeCount=o&&o.length||0,c._image.src=c._link,c._image.alt=c._name,c._nameElement.textContent=c._name,c._likeCountElement.textContent=c._likeCount})),o(this,"getCard",(function(){return c._card})),o(this,"getId",(function(){return c._id})),o(this,"getLikesOwnerIds",(function(){return c._likes.map((function(t){return t._id}))})),o(this,"disableBin",(function(){return c._binButton.remove()})),o(this,"removeCard",(function(){return c._card.remove()})),o(this,"setLikeStatus",(function(){return c._likeElement.classList.add(c._likeActiveClass)})),o(this,"_setEventListeners",(function(){c._likeElement.addEventListener("click",c._handleLikeIconClick.bind(c)),c._binButton.addEventListener("click",c._handleBinButtonClick.bind(c)),c._card.addEventListener("click",c._showCardMethod.bind(c,c._link,c._name))})),o(this,"_handleLikeIconClick",(function(t){t.stopPropagation(),t.target.classList.toggle(c._likeActiveClass),c._likeSetMethod()})),o(this,"_handleBinButtonClick",(function(t){t.stopPropagation(),c._deleteCardMethod(t)})),this._showCardMethod=r,this._deleteCardMethod=i,this._likeSetMethod=u,this._init(n),this.setCard(e),this._setEventListeners()};function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,"enableValidation",(function(){r._setFormEventListeners(),r._toggleButtonState()})),u(this,"_setFormEventListeners",(function(){r._form.addEventListener("reset",(function(){return r._toggleButtonState(!0)})),r._inputList.forEach((function(t){return t.addEventListener("input",(function(){return r._checkInputValidity(t)}))}))})),u(this,"_toggleButtonState",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r._hasErrorField()||t?(r._buttonSubmit.classList.add(r._inactiveButtonClass),r._buttonSubmit.setAttribute("disabled","true")):(r._buttonSubmit.classList.remove(r._inactiveButtonClass),r._buttonSubmit.removeAttribute("disabled"))})),u(this,"_setFieldError",(function(t,e){e.length>0?t.classList.add(r._activeErrorSelector):t.classList.remove(r._activeErrorSelector),t.textContent=e})),u(this,"_hasErrorField",(function(){return Array.from(r._inputList).some((function(t){return!t.validity.valid}))})),u(this,"_checkInputValidity",(function(t){var e=t.parentElement.querySelector(r._errorSelector);r._setFieldError(e,t.validity.valid?"":t.validationMessage),r._toggleButtonState()})),this._form=n,this._inputList=this._form.querySelectorAll(e.inputSelector),this._buttonSubmit=this._form.querySelector(e.submitButtonSelector),this._errorSelector=e.errorSelector,this._activeErrorSelector=e.errorActiveSelector,this._inactiveButtonClass=e.inactiveButtonClass};function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderdItems=e,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"addItem",value:function(t,e){e?this._container.prepend(t):this._container.append(t)}}])&&a(e.prototype,n),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._element=document.querySelector(e)}var e,n;return e=t,(n=[{key:"open",value:function(){return!this._element.classList.contains("popup_opened")&&(this._element.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose.bind(this)),!0)}},{key:"close",value:function(){document.removeEventListener("keydown",this._handleEscClose.bind(this)),this._element.classList.remove("popup_opened")}},{key:"_handleEscClose",value:function(t){t.stopPropagation(),"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._element.addEventListener("click",(function(e){(e.target===t._element||e.target.classList.contains("popup__close-button"))&&t.close()}))}}])&&s(e.prototype,n),t}();function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?v(t):e}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(u,t);var r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(r);if(o){var n=b(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return h(this,t)});function u(t,r){var o,c,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";return _(this,u),y(v(c=i.call(this,t)),"open",(function(){m((o=v(c),b(u.prototype)),"open",o).call(o),c._addSubmitListener()})),y(v(c),"get",(function(){return c._form})),y(v(c),"_getInputValues",(function(){return Array.from(c._inputList).reduce((function(t,e){return t[e.name]=e.value,t}),{})})),y(v(c),"setInputValues",(function(t){var e=new Event("input");c._inputList.forEach((function(n){n.value=t[n.name]||"",n.dispatchEvent(e)}))})),y(v(c),"_addSubmitListener",(function(){return c._form.addEventListener("submit",c._handlerSubmit)})),y(v(c),"_removeSubmitListener",(function(){return c._form.removeEventListener("submit",c._handlerSubmit)})),y(v(c),"_handlerSubmit",(function(t){t.preventDefault(),c._removeSubmitListener(),c._popupSubmitButton.setAttribute("disabled","true");var e=c._popupSubmitButton.textContent;c._popupSubmitButton.textContent=c._processName,c._submitFunction(c._getInputValues()).then((function(t){c.close(),setTimeout((function(){c._form.reset(),c._popupSubmitButton.textContent=e}),500)})).catch((function(t){console.error(t),c._addSubmitListener(),c._popupSubmitButton.textContent=e})).then((function(t){return c._popupSubmitButton.removeAttribute("disabled")}))})),c._form=c._element.querySelector(e),c._popupSubmitButton=c._element.querySelector(n),c._inputList=c._form.querySelectorAll("input"),c._submitFunction=r,c._processName=a,c}return u}(f);function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?w(t):e}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function L(t,e,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=O(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=O(e);if(n){var o=O(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return C(this,t)});function o(){var t,e;E(this,o);for(var n=arguments.length,i=new Array(n),u=0;u<n;u++)i[u]=arguments[u];return B(w(e=r.call.apply(r,[this].concat(i))),"open",(function(n,r){return!!L((t=w(e),O(o.prototype)),"open",t).call(t)&&(e.subject=n,e._method=r,e._addSubmitListener(),!0)})),B(w(e),"submit",(function(){return e._method.bind(e.subject)()})),e}return o}(S);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e,n){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=T(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function q(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=T(r);if(o){var n=T(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return q(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._popupImage=e._element.querySelector(".popup__picture-image"),e._popupName=e._element.querySelector(".popup__picture-name"),e}return e=u,(n=[{key:"open",value:function(t){this._popupImage.src=t.link,this._popupImage.alt=t.name,this._popupName.textContent=t.name,A(T(u.prototype),"open",this).call(this)}}])&&I(e.prototype,n),u}(f);function U(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var M=new function t(e){var n=this,r=e.token,o=e.baseUrl;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"_fetch",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"какая-то ошибка",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",o=arguments.length>3?arguments[3]:void 0;return fetch(n.baseUrl+t,{method:r,headers:{authorization:n.token,"Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(t){return t.ok?t.json():Promise.reject("[".concat(e,"] Ошибка запроса: ").concat(t.url," ").concat(t.status))}))})),F(this,"loadUserInfo",(function(){return n._fetch("users/me","Ошибка загрузки профиля")})),F(this,"saveUserInfo",(function(t,e){return n._fetch("users/me","Профиль не сохранился","PATCH",{name:t,about:e})})),F(this,"loadCards",(function(){return n._fetch("cards","Ошибка загрузки карточек")})),F(this,"saveCard",(function(t){var e=t.link,r=t.name;return n._fetch("cards","Ошибка сохранения карточки","POST",{name:r,link:e})})),F(this,"deleteCard",(function(t){return n._fetch("cards/"+t,"Ошибка удаления карточки","DELETE")})),F(this,"like",(function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n._fetch("cards/likes/"+t,"Ошибка ".concat(e?"установки":"снятия"," лайка"),e?"PUT":"DELETE")})),F(this,"setAvatar",(function(t){return n._fetch("users/me/avatar","Ошибка утановки аватара","PATCH",{avatar:t})})),this.token=r,this.baseUrl=o}({token:"d119b3a4-6901-4a18-8871-5024c655ab94",baseUrl:"https://mesto.nomoreparties.co/v1/cohort-23/"}),V=new function t(e,n,r,o){var i=this,u=e.profileSelector,c=e.profileNameSelector,a=e.profileDescriptionSelector,l=e.profileAvatarSelector,s=e.profileAvatarEditSelector,f=e.profileAvatarInvisibleClass,p=e.profileEditButtonSelector,_=e.profileEditButtonHiddenClass,d=e.profileAddPlaceButtonSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"getUserInfo",(function(){return{name:i._name.textContent,description:i._description.textContent}})),U(this,"setUserInfo",(function(t){var e=t.name,n=t.about,r=t._id;i._name.textContent=e,i._description.textContent=n,i._id=r})),U(this,"itIsMe",(function(t){return t===i._id})),U(this,"setAvatar",(function(t){i._avatar.src=t,i._avatar.classList.remove(i._avatarInvisibleClass)})),U(this,"showEditButton",(function(){return i._profileEditButton.classList.remove(i._buttonHiddenClass)})),U(this,"setEventListeners",(function(){i._profileEditButton.addEventListener("click",(function(){i._editProfileFunction(i.getUserInfo())})),i._avatarEditButton.addEventListener("click",(function(){i._updateAvatarFunction({link:i._avatar.src})})),i._placeAddButton.addEventListener("click",(function(){i._addPlaceFunction()}))}));var h=document.querySelector(u);this._name=h.querySelector(c),this._description=h.querySelector(a),this._avatar=h.querySelector(l),this._avatarEditButton=h.querySelector(s),this._profileEditButton=h.querySelector(p),this._placeAddButton=h.querySelector(d),this._buttonHiddenClass=_,this._avatarInvisibleClass=f,this._editProfileFunction=n,this._updateAvatarFunction=o,this._addPlaceFunction=r}({profileSelector:".profile",profileNameSelector:".profile__name",profileDescriptionSelector:".profile__description",profileAvatarSelector:".profile__avatar",profileAvatarInvisibleClass:"profile__avatar_invisible",profileAvatarEditSelector:".profile__avatat-edit-button",profileEditButtonSelector:".profile__edit-button",profileEditButtonHiddenClass:"profile__edit-button_hidden",profileAddPlaceButtonSelector:".profile__add-place-button"},(function(t){K.setInputValues(t),K.open()}),(function(){return J.open()}),(function(t){W.setInputValues(t),W.open()})),D=M.loadUserInfo().then((function(t){V.setUserInfo(t),V.showEditButton(),V.setAvatar(t.avatar)})).catch((function(t){console.error(t),V.setUserInfo("Профиль не загружен!","Что-то пошло не так...")})),N=[],H=M.loadCards().then((function(t){return N=t})).catch((function(t){return console.error(t)})),z=new l([],".elements");Promise.allSettled([D,H]).then((function(t){return N.forEach((function(t){return X(t,z)}))}));var G=new x(".popup_view"),J=new S(".popup_add",(function(t){return M.saveCard(t).then((function(t){return X(t,z,!0)}))})),K=new S(".popup_edit-profile",(function(t){return M.saveUserInfo(t.name,t.description).then((function(t){return V.setUserInfo(t)}))})),Q=new P(".popup_delete",(function(t){return M.deleteCard(Q.subject.getId()).then((function(t){return Q.submit()}))}),"Удаление..."),W=new S(".popup_edit-avatar",(function(t){return M.setAvatar(t.link).then((function(t){return V.setAvatar(t.avatar)}))})),X=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,u=function(t){return t.getLikesOwnerIds().some((function(t){return V.itIsMe(t)}))},c=new i(e,o,(function(t,e){return G.open({link:t,name:e})}),(function(){return Q.open(c,c.removeCard)}),(function(){return M.like(c.getId(),!u(c)).then((function(t){return c.setCard(t)})).catch((function(t){return console.error(t)}))}));V.itIsMe(e.owner._id)||c.disableBin(),u(c)&&c.setLikeStatus(),n.addItem(c.getCard(),r)};[J,K,W].forEach((function(t){return new c(r,t.get()).enableValidation()})),G.setEventListeners(),J.setEventListeners(),K.setEventListeners(),Q.setEventListeners(),W.setEventListeners(),V.setEventListeners()})();